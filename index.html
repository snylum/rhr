<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Hand Orientation Control</title>
  <style>
    body { margin: 0; background: #111; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dat.gui@0.7.9/build/dat.gui.min.js"></script>

  <script>
    // === Basic Scene Setup ===
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x111111);

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(3, 3, 5);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(5, 10, 5);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));

    // === Coordinate Axes ===
    const axesHelper = new THREE.AxesHelper(3);
    scene.add(axesHelper);

    // === Hand Placeholder Geometry ===
    // Simple abstract hand: box for palm + cylinders for fingers + small thumb
    const handGroup = new THREE.Group();

    const palmGeometry = new THREE.BoxGeometry(1, 0.2, 1.2);
    const palmMaterial = new THREE.MeshStandardMaterial({ color: 0x00aaff, metalness: 0.3, roughness: 0.7 });
    const palmMesh = new THREE.Mesh(palmGeometry, palmMaterial);
    palmMesh.position.set(0, 0, 0);
    handGroup.add(palmMesh);

    const fingerMaterial = new THREE.MeshStandardMaterial({ color: 0x55ccff });
    const fingerGeo = new THREE.CylinderGeometry(0.07, 0.07, 0.7, 16);

    const fingerPositions = [-0.4, -0.2, 0, 0.2, 0.4];
    const fingersGroup = new THREE.Group();
    for (let i = 0; i < 5; i++) {
      const f = new THREE.Mesh(fingerGeo, fingerMaterial);
      f.rotation.x = Math.PI / 2;
      f.position.set(fingerPositions[i], 0.25, 0.6);
      fingersGroup.add(f);
    }
    handGroup.add(fingersGroup);

    const thumb = new THREE.Mesh(fingerGeo, new THREE.MeshStandardMaterial({ color: 0xff8855 }));
    thumb.rotation.z = Math.PI / 3;
    thumb.position.set(-0.65, 0, 0.2);
    handGroup.add(thumb);

    scene.add(handGroup);

    // Palm faces upwards (parallel to fingers)
    handGroup.rotation.x = -Math.PI / 2;

    // === Vector Controls ===
    const handOrientation = {
      fingerVector: new THREE.Vector3(1, 0, 0),
      thumbVector: new THREE.Vector3(0, 1, 0),
      palmVector: new THREE.Vector3(0, 0, 1),
      fingerVectorName: 'Finger Vector',
      thumbVectorName: 'Thumb Vector',
      palmVectorName: 'Palm Vector'
    };

    // === GUI Setup ===
    const gui = new dat.GUI({ width: 180 });
    const orientationFolder = gui.addFolder('Orientation Vectors');
    orientationFolder.add(handOrientation, 'fingerVectorName').name('Finger Name');
    orientationFolder.add(handOrientation, 'thumbVectorName').name('Thumb Name');
    orientationFolder.add(handOrientation, 'palmVectorName').name('Palm Name');

    const fingerFolder = orientationFolder.addFolder('Finger Dir');
    fingerFolder.add(handOrientation.fingerVector, 'x', -1, 1, 0.1);
    fingerFolder.add(handOrientation.fingerVector, 'y', -1, 1, 0.1);
    fingerFolder.add(handOrientation.fingerVector, 'z', -1, 1, 0.1);

    const thumbFolder = orientationFolder.addFolder('Thumb Dir');
    thumbFolder.add(handOrientation.thumbVector, 'x', -1, 1, 0.1);
    thumbFolder.add(handOrientation.thumbVector, 'y', -1, 1, 0.1);
    thumbFolder.add(handOrientation.thumbVector, 'z', -1, 1, 0.1);

    const palmFolder = orientationFolder.addFolder('Palm Dir');
    palmFolder.add(handOrientation.palmVector, 'x', -1, 1, 0.1);
    palmFolder.add(handOrientation.palmVector, 'y', -1, 1, 0.1);
    palmFolder.add(handOrientation.palmVector, 'z', -1, 1, 0.1);

    orientationFolder.open();

    // === Helper for visualizing vectors ===
    const vectorHelpers = {
      finger: new THREE.ArrowHelper(handOrientation.fingerVector.clone().normalize(), new THREE.Vector3(0, 0, 0), 1, 0xff0000),
      thumb: new THREE.ArrowHelper(handOrientation.thumbVector.clone().normalize(), new THREE.Vector3(0, 0, 0), 1, 0x00ff00),
      palm: new THREE.ArrowHelper(handOrientation.palmVector.clone().normalize(), new THREE.Vector3(0, 0, 0), 1, 0x0000ff)
    };
    scene.add(vectorHelpers.finger);
    scene.add(vectorHelpers.thumb);
    scene.add(vectorHelpers.palm);

    // === Animation Loop ===
    function animate() {
      requestAnimationFrame(animate);
      controls.update();

      // Default fallback: if all vectors are zero, hand faces +Z
      const defaultFacing = new THREE.Vector3(0, 0, 1);

      const hasVector =
        handOrientation.fingerVector.length() !== 0 ||
        handOrientation.thumbVector.length() !== 0 ||
        handOrientation.palmVector.length() !== 0;

      const palmVec = hasVector
        ? handOrientation.palmVector.clone().normalize()
        : defaultFacing;

      // Update helper arrows
      vectorHelpers.finger.setDirection(handOrientation.fingerVector.clone().normalize());
      vectorHelpers.thumb.setDirection(handOrientation.thumbVector.clone().normalize());
      vectorHelpers.palm.setDirection(palmVec);

      // Orient hand to face palm vector
      const target = palmVec.clone().multiplyScalar(5);
      handGroup.lookAt(target);

      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
